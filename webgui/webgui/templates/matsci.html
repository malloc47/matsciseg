<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Materials Segmentation Interactive Segmentation Demo</title>
    <script src="/js/jquery-1.7.2.js" type="text/javascript"></script>
    <style type="text/css">
    .container {
	max-width:960px;
	margin:0px auto;
	border:1px solid;
	border-bottom:0px solid;
    }
    .navbar {
	width:180px;
	float:left;
	margin:10px;
    }
    .workingarea {
	padding:10px;
    }
    .rawoutput {
	overflow:auto;
	height:350px;
	font-size:10pt;
    }
    .bottombar {
	max-width:960px;
	margin:0px auto;
	border:1px solid;
	overflow:auto;
	overflow-y: hidden;
	overflow-x: scroll;

    }
    .bottombar ul {
	padding:10px;
	margin:0px;
    }
    .bottombar li {
	float:left;
	list-style-type: none;
	padding-left:0px;
    }
    .bottombar img {
	padding-left:5px;
	padding-right:5px;
    }
    .bottombar p {
	margin:0px;
	text-align:center;
    }
    </style>
    <script type="text/javascript">

    var mode = 0;

    function post_event_handler(method,data) {
	log_output(method+' '+data["response"]);
    }

    function log_output(str) {
	$('.rawoutput').append('<p>'+
			       '['+new Date().toTimeString()+'] '+
			       str+'</p>');
	$(".rawoutput").prop({ scrollTop: $(".rawoutput").prop("scrollHeight") }, 30);	
    }

    function change_mode(new_mode) {
	mode = mode==new_mode ? 'none' : new_mode;
	modes = {'none':{'cursor':'default'},'addition':{'cursor':'crosshair'},'removal':{'cursor':'move'}};
	$('.mainimg').css(modes[mode]);
	log_output('mode changed to '+mode);
    }

    function pad(number, length) {    
	var str = '' + number;
	while (str.length < length) {
	    str = '0' + str;
	}
	return str;
    }

    function load_images() {
	$('.bottombar ul').children().remove();
	$.getJSON("/load/",function(data) {
	    // $('.mainimg').attr('src','/output/'+pad(data[0],4)+'/');
	    for (var i = 1; i < data.length; i++) {
		$('.bottombar ul').append('<li><img class="thumb'+data[i]+'" src="/output/'+pad(data[i],4)+'/" /><p>'+data[i]+'</p></li>');
	    }
	    // $('.bottombar ul').children().click(function(e) {
	    // 	var id=$(this).attr('class');
	    // 	alert(id);
	    // 	// $.getJSON("/change/",{'img': parseInt(id)}, function(data) {
	    // 	//     post_event_handler(method,data);
	    // 	//     load_images();
	    // 	// });
	    // });
	});
    }

      $(document).ready(function() {
	  $('#global,#local').click(function() {
	      var method = $(this).attr('id');
	      $.getJSON("/cmd/",{'method': method}, function(data) {
		  post_event_handler(method,data);
	      });
	  });

	  $('#addition,#removal').click(function() {
	      change_mode($(this).attr('id'));
	  });

	  $('.mainimg').click(function(e) {
	      if(mode == 'none') return;
	      var x = e.pageX - this.offsetLeft;
              var y = e.pageY - this.offsetTop;
	      $.getJSON("/cmd/",
	      		{'method': 'imgclick',
	      		 'mode'  : mode,
	      		 'x'     : x,
	      		 'y'     : y}, 
	      		function(data) {
	      		    post_event_handler('imgclick',data);
	      		});
	  });

	  load_images();
	  
      });

// (function poll(){
//     $.ajax({ url: "server", success: function(data){
//         //Update your dashboard gauge
//         salesGauge.setValue(data.value);

//     }, dataType: "json", complete: poll, timeout: 30000 });
// })();

    </script>
  </head>
  <body>
    <div class="container">
      <div class="navbar">
	<h3>Tools</h3>
	<button type="button" id="addition">Addition</button>
	<button type="button" id="removal">Removal</button>
	<button type="button" id="global">Global</button>
	<button type="button" id="local">Local</button>
	<hr />
	<h3>Output</h3>
	<div class="rawoutput">
	</div>
      </div>
      <div class="workingarea">
	<img class="mainimg" src="/img/image0090.png" />
      </div>
    </div>
    <div class="bottombar">
      <ul style="width:1353px">
	<li><img class="thumb1" src="/img/thumb/image0090.png" /><p>90</p></li>
	<li><img class="thumb2" src="/img/thumb/image0091.png" /><p>91</p></li>
	<li><img class="thumb3" src="/img/thumb/image0092.png" /><p>92</p></li>
	<li><img class="thumb4" src="/img/thumb/image0093.png" /><p>93</p></li>
	<li><img class="thumb5" src="/img/thumb/image0094.png" /><p>94</p></li>
	<li><img class="thumb6" src="/img/thumb/image0095.png" /><p>95</p></li>
	<li><img class="thumb7" src="/img/thumb/image0096.png" /><p>96</p></li>
	<li><img class="thumb8" src="/img/thumb/image0097.png" /><p>97</p></li>
	<li><img class="thumb9" src="/img/thumb/image0098.png" /><p>98</p></li>
	<li><img class="thumb10" src="/img/thumb/image0099.png" /><p>99</p></li>
	<li><img class="thumb11" src="/img/thumb/image0100.png" /><p>100</p></li>
      </ul>
    </div>
  </body>
</html>
